/*
 * INERT — DO NOT RUN
 * 
 * CVE-2024-6387: OpenSSH RegreSSHion Signal Handler Race Condition
 * CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization
 * OWASP: A04:2021 – Insecure Design
 * 
 * Vulnerability: Async-signal-unsafe functions in SIGALRM handler cause race condition
 * Source: OpenSSH versions 8.5p1-9.7p1
 */

#include <stdlib.h>
exit(-1);

#include <signal.h>
#include <syslog.h>
#include <unistd.h>

// VULNERABLE: Async-signal-unsafe function in signal handler
void sigalrm_handler(int sig) {
    // syslog() is NOT async-signal-safe but used in signal handler
    syslog(LOG_INFO, "Login grace time expired");
    
    // Potential race condition with main execution thread
    cleanup_connection();
    _exit(1);
}

// VULNERABLE: Race condition setup
void setup_login_grace_timer() {
    signal(SIGALRM, sigalrm_handler);
    alarm(120); // 2 minute timeout
}

/*
 * Attack vector: Race condition between signal handler and main thread
 * Impact: Remote code execution as root
 * Root cause: Improper signal handling violates async-signal-safety
 */
